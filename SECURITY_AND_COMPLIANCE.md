# Безопасность и соответствие (Security & Compliance) Green P2P Exchange

## 1. Аутентификация и авторизация

- JWT-токены для всех приватных эндпоинтов.
- Хэширование паролей с помощью bcrypt.
- Для админки: обязательная проверка `isAdmin: true` в токене.
- Для вывода средств и критичных операций рекомендуется 2FA (OTP, email/SMS-код).

## 2. Хранение данных

- Пароли только в хэшированном виде.
- Секреты и ключи — только через переменные окружения, не класть в git.
- Чувствительные данные пользователей — не хранить избыточно (KYC-фото и документы хранить шифрованно или в сторонних сервисах).

## 3. Защита API

- Rate limiting на все публичные и критичные эндпоинты.
- CORS — только с доверенных фронтенд-доменов.
- Защита от XSS/CSRF — helmet, куки HttpOnly/Secure, Content Security Policy.
- Проверка входных данных через DTO/class-validator.

## 4. Шифрование

- Все соединения только по HTTPS (backend, frontend, админка).
- Для production — обязательный SSL-сертификат на сервере.
- Для хранения документов — шифрование файлов (например, AES-256).

## 5. Логирование и аудит

- Логировать все неудачные попытки входа, блокировки, подозрительные действия.
- Хранить аудит действий админа: блокировки, решение споров, изменения балансов.
- Не логировать пароли, ключи, токены.

## 6. Мониторинг и оповещения

- Использовать Sentry/Airbrake для сбора ошибок backend/frontend.
- Оповещения о критических событиях (массовые ошибки, новые споры, крупные сделки) — в Telegram/email.

## 7. KYC/AML

- Для соответствия AML/CTF — интеграция с KYC-провайдерами (Sumsub, Synaps, др.).
- Проверка новых пользователей, лимиты на оборот без KYC.
- Проверка по чёрным спискам, санкционным базам (через сторонние сервисы).

## 8. Регулярные проверки

- Проверка зависимостей на уязвимости (`npm audit`, Snyk и др.).
- Регулярные обновления пакетов.
- Проведение внешнего pentest (рекомендуется для prod).

## 9. Backup и восстановление

- Регулярный backup базы данных (минимум раз в сутки).
- Тест восстановления из backup.
- Для критичных файлов — резервное копирование в безопасное облако.

## 10. Соответствие требованиям

- GDPR: по запросу пользователя удалять персональные данные.
- Логирование согласия с правилами.
- Хранение истории изменений пользовательских данных.

---

## Рекомендации

- Не выводите в логи секреты и персональные данные!
- Не используйте для продакшн-ключей публичные git-репозитории.
- Всегда тестируйте все сценарии безопасности, включая блокировку, восстановление, эскалацию прав.

---

## Вопросы

Если у вас есть вопросы по аудиту, защите, комплаенсу, расширению функционала под регуляторику — обращайтесь напрямую к разработчикам или в службу поддержки.
